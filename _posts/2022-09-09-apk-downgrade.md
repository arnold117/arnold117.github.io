---
layout: post
title: "使用ADB对Android应用程序进行保存数据的安全降级-微信为例"
date:   2022-09-09
tags: [Android]
comments: true
author: Arnold
toc: true
---
简单的ADB操作实现保留数据的无损降级。

<!-- more -->

# 0. 前言
相信大家都已经是安装了最新版本的各类软件，手机空间也随着使用越来越小。尤其是某著名国民“**小而美**”软件，它这臃肿程度，储存动不动就是几十GB，内存占用也动不动几GB，这已经不是普通的垃圾软件了，不能再犹豫了，一定要重拳出击！

一般而言，为了解决软件臃肿问题的最优解是直接卸载再安装旧版。但以微信为例，你卸载软件后你的聊天记录就**没有了**(为什么不能学学QQ来个云端保存？)；而且微信限制你登录旧版本，卸载后再安装显然是不合理的。

那么就没有办法了吗？别急，微信限制你登录旧版本，但不限制你继续使用旧版本。也就是说：只要微信认为你一直登录在旧版本上，你把自动更新关闭，它也会让你继续用，也不会强行让你更新。那么只要你在降级的同时保留原有的数据，降级完成后默认就是登录状态，自然也不会有限制你登录的麻烦事情。

# 1. 环境配置
我提供的方法需要使用ADB，推荐在电脑上使用，请自行下载并配置ADB。

考虑到大部分看此文章的人都是国内Windows玩家，且不从事相关开发，在此放出一个简单的配置方式：  
从此网站下载[SDK Platform-Tools](https://developer.android.com/studio/releases/platform-tools)，解压后将文件内容**移动到没有中文等特殊字符的目录下**，并将该目录添加到系统环境变量。

随后推荐使用数据线将Android手机链接在电脑上(注: **鸿蒙手机也是Android手机**，亦可使用本方法。)，并自行打开手机的USB调试与USB安装，并确保adb正确连接。

大部分手机打开USB调试和USB安装的方法：
1. 打开 设置-系统-关于手机 连续点击版本号10次
2. 进入 设置-系统-开发者模式 找到USB调试与USB安装，并开启

注：华为手机默认没有ADB驱动，需要连接后安装华为手机助手才可以在电脑上正常连接ADB

# 2. 获取历史版本
大家可以从豌豆荚，apkpure等地获取旧版apk，下方放出微信旧版的链接，需要你在极佳的互联网环境下打开。  
[APKPURE的微信7.0.21版本下载地址](https://apkpure.com/cn/wechat/com.tencent.mm/download/1783-APK?from=popup%2Fversion)

大家下载的时候一定要选择apk文件下载哦！

# 3. 安全降级
直接在手机中打开刚才下载的Apk是无法进行安装的，系统安装器会提示不能降低版本安装之类的。  
这在Android系统源码中有所对应，感兴趣的同学可以查阅[AOSP](frameworks/base/core/java/com/android/internal/content/PackageHelper.java)，其中定义了此情况的错误码：
```
public static final int RECOMMEND_FAILED_VERSION_DOWNGRADE = -7;
```
所以，接下来我们需要通过adb命令来安装了，终端执行即可：
```
adb install -r -d 你的apk包相对路径与名称
```
-r 参数表示覆盖安装且保留数据，微信无数个GB的聊天数据不是说清就能清的，就算不在乎聊天记录，你清掉了数据就需要再登录，然后你就会发现你登不上去(笑。  
-d 参数表示强制将低版本覆盖安装到现有版本上，无论现有高低。

以上，你就完成了降级。是不是发现内存占用小了好多呢(笑

此文就到此结束啦！欢迎大家在评论区留言哦ヾ(^▽^*)))  
Ciallo～(∠・ω< )⌒☆​  
写文不易，如果你觉得我的文章对你有帮助，欢迎[打赏](https://arnold117.github.io/likes/)！